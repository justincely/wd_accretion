#!/usr/bin/env python

import os
import sys
import smtplib
import subprocess
import time
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
import time

#time.sleep(10)

folder = sys.argv[1]
os.chdir(folder)

class Logger(object):
    def __init__(self,filename):
        self.terminal = sys.stdout
        self.log = open(filename, "w")

    def write(self, message):
        self.terminal.write(message)
        self.log.write(message)

    def flush(self):
        self.terminal.flush()

sys.stdout = Logger('condor.stdout')
sys.stderr = Logger('condor.stderr')
'''
if sys.platform.startswith('linux'):
    if os.path.exists('/usr/bin/g77'):
        p = subprocess.Popen(['make', 'compile_g77'], shell=True)
    elif os.path.exists('/usr/bin/gfortran'):
        p = subprocess.Popen(['make', 'compile_gfortran'], shell=True)
    else:
        sys.exit('No fortran')
elif sys.platform == 'darwin':
    p = subprocess.Popen(['make', 'compile_osx'])
else:
    sys.exit('FAILURE to compile!')
p.communicate()
p.wait()
'''
if os.path.exists('/usr/bin/g77'):
    p = subprocess.Popen(['./mercury6_g77'])
elif os.path.exists('/usr/bin/gfortran'):
    p = subprocess.Popen(['./mercury6_gfortran'])
else:
    sys.exit('No fortran')

p.communicate()
p.wait()

if os.path.exists('out_encounters.txt'):
    os.remove('out_encounters.txt')

